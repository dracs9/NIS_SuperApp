{% extends "base.html" %}

{% block title %}{{ team.name }} – Teams – NIS SuperApp{% endblock %}

{% block content %}
<div class="mx-auto max-w-3xl">
  <nav class="mb-4 text-sm">
    <a href="{% url 'teams:feed' %}" class="text-zinc-500 hover:text-zinc-700 dark:text-zinc-400 dark:hover:text-zinc-200">← Teams</a>
  </nav>

  <div class="rounded-2xl border border-zinc-200 bg-white shadow-sm dark:border-zinc-700 dark:bg-zinc-800 overflow-hidden">
    <div class="border-b border-zinc-200 px-6 py-4 dark:border-zinc-700">
      <div class="flex flex-wrap items-start justify-between gap-3">
        <div>
          <h1 class="text-xl font-bold text-zinc-900 dark:text-zinc-100">{{ team.name }}</h1>
          <p class="mt-1 text-sm text-zinc-500 dark:text-zinc-400">
            {% if team.opportunity %}<a href="{% url 'opportunities:detail' team.opportunity.pk %}" class="text-emerald-600 hover:text-emerald-500 dark:text-emerald-400">{{ team.opportunity.title }}</a>{% else %}General team{% endif %}
          </p>
        </div>
        {% if team.is_open %}
        <span class="inline-flex items-center rounded-full bg-emerald-100 px-2.5 py-0.5 text-xs font-medium text-emerald-800 dark:bg-emerald-900/50 dark:text-emerald-300">Open</span>
        {% else %}
        <span class="inline-flex items-center rounded-full bg-zinc-100 px-2.5 py-0.5 text-xs font-medium text-zinc-600 dark:bg-zinc-700 dark:text-zinc-300">Closed</span>
        {% endif %}
      </div>
      {% if team.description %}
      <p class="mt-3 text-sm text-zinc-600 dark:text-zinc-400">{{ team.description }}</p>
      {% endif %}
    </div>

    <div class="border-b border-zinc-200 px-6 py-4 dark:border-zinc-700">
      <h2 class="text-sm font-semibold text-zinc-700 dark:text-zinc-300">Members</h2>
      <ul class="mt-2 space-y-2">
        {% for member in members %}
        <li class="flex items-center justify-between text-sm">
          <span class="text-zinc-900 dark:text-zinc-100">{{ member.user.email }}{% if member.is_leader %} <span class="text-amber-600 dark:text-amber-400">(leader)</span>{% endif %}</span>
        </li>
        {% empty %}
        <li class="text-sm text-zinc-500 dark:text-zinc-400">No members yet.</li>
        {% endfor %}
      </ul>
    </div>

    {% if user.is_authenticated %}
    <div class="px-6 py-4 space-y-4">
      {% if is_member %}
      <p class="text-sm text-zinc-500 dark:text-zinc-400">You are a member of this team.</p>
      {% if can_manage %}
      <a href="{% url 'teams:invite' team.pk %}" class="inline-flex items-center gap-2 rounded-xl bg-indigo-600 px-4 py-2.5 text-sm font-semibold text-white hover:bg-indigo-500 dark:bg-indigo-500 dark:hover:bg-indigo-400">Invite member</a>
      {% endif %}
      {% elif user_request and user_request.status == 'pending' %}
        <p class="text-sm text-amber-600 dark:text-amber-400">Your {% if user_request.is_invitation %}invitation{% else %}application{% endif %} is pending.</p>
        {% if user_request.is_invitation %}
        <form action="{% url 'teams:request_accept' team.pk user_request.pk %}" method="post" class="inline">
          {% csrf_token %}
          <button type="submit" class="rounded-xl bg-emerald-600 px-4 py-2.5 text-sm font-semibold text-white hover:bg-emerald-500 dark:bg-emerald-500 dark:hover:bg-emerald-400">Accept invite</button>
        </form>
        <form action="{% url 'teams:request_reject' team.pk user_request.pk %}" method="post" class="inline ml-2">
          {% csrf_token %}
          <button type="submit" class="rounded-xl border border-red-300 bg-red-50 px-4 py-2.5 text-sm font-semibold text-red-800 hover:bg-red-100 dark:border-red-800 dark:bg-red-900/20 dark:text-red-300">Decline</button>
        </form>
        {% endif %}
      {% else %}
      <form action="{% url 'teams:apply' team.pk %}" method="post" class="space-y-2">
        {% csrf_token %}
        <textarea name="message" rows="2" class="input-field w-full" placeholder="Why do you want to join? (optional)"></textarea>
        <button type="submit" class="rounded-xl bg-emerald-600 px-4 py-2.5 text-sm font-semibold text-white hover:bg-emerald-500 dark:bg-emerald-500 dark:hover:bg-emerald-400">Apply to join</button>
      </form>
      {% endif %}

      {% if can_manage and pending_requests %}
      <div class="pt-4 border-t border-zinc-200 dark:border-zinc-700">
        <h3 class="text-sm font-semibold text-zinc-700 dark:text-zinc-300">Pending requests</h3>
        <ul class="mt-2 space-y-2">
          {% for req in pending_requests %}
          <li class="flex items-center justify-between rounded-lg border border-zinc-200 bg-zinc-50 p-3 dark:border-zinc-700 dark:bg-zinc-800/50">
            <div>
              <span class="text-sm font-medium text-zinc-900 dark:text-zinc-100">{{ req.user.email }}</span>
              <span class="text-xs text-zinc-500 dark:text-zinc-400">{% if req.is_invitation %}invited{% else %}applied{% endif %}</span>
              {% if req.message %}<p class="mt-1 text-xs text-zinc-600 dark:text-zinc-400">{{ req.message }}</p>{% endif %}
            </div>
            <div class="flex gap-2">
              <form action="{% url 'teams:request_accept' team.pk req.pk %}" method="post" class="inline">
                {% csrf_token %}
                <button type="submit" class="rounded-lg bg-emerald-600 px-2 py-1 text-xs font-semibold text-white hover:bg-emerald-500">Accept</button>
              </form>
              <form action="{% url 'teams:request_reject' team.pk req.pk %}" method="post" class="inline">
                {% csrf_token %}
                <button type="submit" class="rounded-lg border border-zinc-300 bg-white px-2 py-1 text-xs font-semibold text-zinc-700 hover:bg-zinc-50 dark:border-zinc-600 dark:bg-zinc-800 dark:text-zinc-300">Reject</button>
              </form>
            </div>
          </li>
          {% endfor %}
        </ul>
      </div>
      {% endif %}
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
