{% extends "base.html" %}
{% load role_tags %}

{% block title %}Events – NIS SuperApp{% endblock %}

{% block content %}
<div class="mx-auto max-w-4xl">
  <div class="flex flex-wrap items-center justify-between gap-4">
    <div>
      <h1 class="text-2xl sm:text-3xl font-bold text-zinc-900 dark:text-zinc-100">Events</h1>
      <p class="mt-1 text-sm text-zinc-500 dark:text-zinc-400">School events: upcoming, planned, and past</p>
    </div>
    {% if user.is_authenticated %}{% if user|has_role:"student_council" or user|has_role:"admin" %}
    <a href="{% url 'events:wizard' step=1 %}" class="inline-flex items-center gap-2 rounded-xl bg-emerald-600 px-4 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-emerald-500 dark:bg-emerald-500 dark:hover:bg-emerald-400">
      <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
      Create event
    </a>
    {% endif %}{% endif %}
  </div>

  <div class="mt-8" x-data="{ tab: 'upcoming' }">
    <div class="border-b border-zinc-200 dark:border-zinc-700">
      <nav class="-mb-px flex gap-4" aria-label="Tabs">
        <button type="button" @click="tab = 'upcoming'" :class="tab === 'upcoming' ? 'border-emerald-500 text-emerald-600 dark:text-emerald-400' : 'border-transparent text-zinc-500 hover:border-zinc-300 hover:text-zinc-700 dark:text-zinc-400 dark:hover:text-zinc-300'" class="whitespace-nowrap border-b-2 py-3 px-1 text-sm font-medium">Upcoming</button>
        <button type="button" @click="tab = 'planned'" :class="tab === 'planned' ? 'border-emerald-500 text-emerald-600 dark:text-emerald-400' : 'border-transparent text-zinc-500 hover:border-zinc-300 hover:text-zinc-700 dark:text-zinc-400 dark:hover:text-zinc-300'" class="whitespace-nowrap border-b-2 py-3 px-1 text-sm font-medium">Planned</button>
        <button type="button" @click="tab = 'past'" :class="tab === 'past' ? 'border-emerald-500 text-emerald-600 dark:text-emerald-400' : 'border-transparent text-zinc-500 hover:border-zinc-300 hover:text-zinc-700 dark:text-zinc-400 dark:hover:text-zinc-300'" class="whitespace-nowrap border-b-2 py-3 px-1 text-sm font-medium">Past</button>
      </nav>
    </div>

    <div x-show="tab === 'upcoming'" x-cloak class="py-6">
      <ul class="space-y-3">
        {% for event in upcoming_events %}
        <li>
          <a href="{% url 'events:detail' event.pk %}" class="block rounded-xl border border-zinc-200 bg-white p-4 shadow-sm transition hover:border-emerald-200 hover:shadow-md dark:border-zinc-700 dark:bg-zinc-800 dark:hover:border-emerald-800">
            <div class="flex flex-wrap items-start justify-between gap-2">
              <div>
                <h3 class="font-semibold text-zinc-900 dark:text-zinc-100">{{ event.title }}</h3>
                <p class="mt-1 text-sm text-zinc-500 dark:text-zinc-400">{{ event.start_at|date:"M j, Y · g:i A" }} — {{ event.location|default:"TBA" }}</p>
              </div>
              <span class="inline-flex items-center rounded-full bg-emerald-100 px-2.5 py-0.5 text-xs font-medium text-emerald-800 dark:bg-emerald-900/50 dark:text-emerald-300">Approved</span>
            </div>
          </a>
        </li>
        {% empty %}
        <li class="rounded-xl border border-zinc-200 bg-white py-12 text-center text-sm text-zinc-500 dark:border-zinc-700 dark:bg-zinc-800 dark:text-zinc-400">No upcoming events.</li>
        {% endfor %}
      </ul>
    </div>

    <div x-show="tab === 'planned'" x-cloak class="py-6">
      <ul class="space-y-3">
        {% for event in planned_events %}
        <li>
          <a href="{% url 'events:detail' event.pk %}" class="block rounded-xl border border-zinc-200 bg-white p-4 shadow-sm transition hover:border-emerald-200 hover:shadow-md dark:border-zinc-700 dark:bg-zinc-800 dark:hover:border-emerald-800">
            <div class="flex flex-wrap items-start justify-between gap-2">
              <div>
                <h3 class="font-semibold text-zinc-900 dark:text-zinc-100">{{ event.title }}</h3>
                <p class="mt-1 text-sm text-zinc-500 dark:text-zinc-400">{{ event.start_at|date:"M j, Y" }} — {{ event.location|default:"TBA" }}</p>
              </div>
              {% if event.status == 'draft' %}
              <span class="inline-flex items-center rounded-full bg-zinc-100 px-2.5 py-0.5 text-xs font-medium text-zinc-700 dark:bg-zinc-600 dark:text-zinc-200">Draft</span>
              {% else %}
              <span class="inline-flex items-center rounded-full bg-amber-100 px-2.5 py-0.5 text-xs font-medium text-amber-800 dark:bg-amber-900/50 dark:text-amber-300">Pending</span>
              {% endif %}
            </div>
          </a>
        </li>
        {% empty %}
        <li class="rounded-xl border border-zinc-200 bg-white py-12 text-center text-sm text-zinc-500 dark:border-zinc-700 dark:bg-zinc-800 dark:text-zinc-400">No planned events.</li>
        {% endfor %}
      </ul>
    </div>

    <div x-show="tab === 'past'" x-cloak class="py-6">
      <ul class="space-y-3">
        {% for event in past_events %}
        <li>
          <a href="{% url 'events:detail' event.pk %}" class="block rounded-xl border border-zinc-200 bg-white p-4 shadow-sm transition hover:border-emerald-200 hover:shadow-md dark:border-zinc-700 dark:bg-zinc-800 dark:hover:border-emerald-800">
            <div class="flex flex-wrap items-start justify-between gap-2">
              <div>
                <h3 class="font-semibold text-zinc-900 dark:text-zinc-100">{{ event.title }}</h3>
                <p class="mt-1 text-sm text-zinc-500 dark:text-zinc-400">{{ event.end_at|date:"M j, Y" }} — {{ event.location|default:"TBA" }}</p>
              </div>
              <span class="text-xs text-zinc-500 dark:text-zinc-400">Past</span>
            </div>
          </a>
        </li>
        {% empty %}
        <li class="rounded-xl border border-zinc-200 bg-white py-12 text-center text-sm text-zinc-500 dark:border-zinc-700 dark:bg-zinc-800 dark:text-zinc-400">No past events.</li>
        {% endfor %}
      </ul>
    </div>
  </div>

  {% if user.is_authenticated and user.is_moderator %}
  <p class="mt-6 text-sm text-zinc-500 dark:text-zinc-400">
    <a href="{% url 'events:review_list' %}" class="font-medium text-emerald-600 hover:text-emerald-500 dark:text-emerald-400">Review pending events →</a>
  </p>
  {% endif %}
</div>
<style>[x-cloak]{display:none!important}</style>
{% endblock %}
